<decision_tables>
<decision_table>
<table_name>Book_Access_Request</table_name>
<xls_file>BookPreview_dt.xls</xls_file>
<attribute_fields>
<TYPE>FIRST</TYPE>
<COMMENTS>This Rule Set manages the Access to eBooks</COMMENTS></attribute_fields>
<contexts></contexts>
<initial_actions></initial_actions>
<conditions>
<condition_details>
<condition_number>1</condition_number>
<condition_comment></condition_comment>
<condition_requirement></condition_requirement>
<condition_description>Access is equal to Purchase</condition_description>
<condition_postfix>
Access Purchase streq 
</condition_postfix>
<condition_column column_value="Y" column_number="1"></condition_column></condition_details>
<condition_details>
<condition_number>2</condition_number>
<condition_comment></condition_comment>
<condition_requirement></condition_requirement>
<condition_description>Access is equal to Preview</condition_description>
<condition_postfix>
Access Preview streq 
</condition_postfix>
<condition_column column_value="Y" column_number="2"></condition_column></condition_details>
<condition_details>
<condition_number>3</condition_number>
<condition_comment></condition_comment>
<condition_requirement></condition_requirement>
<condition_description>Access is equal to Next_Page</condition_description>
<condition_postfix>
Access Next_Page streq 
</condition_postfix>
<condition_column column_value="Y" column_number="3"></condition_column></condition_details>
<condition_details>
<condition_number>4</condition_number>
<condition_comment></condition_comment>
<condition_requirement></condition_requirement>
<condition_description>otherwise</condition_description>
<condition_postfix>
otherwise 
</condition_postfix>
<condition_column column_value="*" column_number="4"></condition_column></condition_details></conditions>
<actions>
<action_details>
<action_number>1</action_number>
<action_comment></action_comment>
<action_requirement></action_requirement>
<action_description>Purchase_Book</action_description>
<action_postfix>
Purchase_Book 
</action_postfix>
<action_column column_value="X" column_number="1"></action_column></action_details>
<action_details>
<action_number>2</action_number>
<action_comment></action_comment>
<action_requirement></action_requirement>
<action_description>Preview_Book</action_description>
<action_postfix>
Preview_Book 
</action_postfix>
<action_column column_value="X" column_number="2"></action_column></action_details>
<action_details>
<action_number>3</action_number>
<action_comment></action_comment>
<action_requirement></action_requirement>
<action_description>Turn_Page</action_description>
<action_postfix>
Turn_Page 
</action_postfix>
<action_column column_value="X" column_number="3"></action_column></action_details>
<action_details>
<action_number>4</action_number>
<action_comment></action_comment>
<action_requirement></action_requirement>
<action_description>Other_Actions</action_description>
<action_postfix>
Other_Actions 
</action_postfix>
<action_column column_value="X" column_number="4"></action_column></action_details></actions>
<policy_statements>
<policy_statement column="1">
<policy_description>Customer intends to Purchase the current book</policy_description>
<policy_statement_postfix>&quot;Customer intends to Purchase the current book&quot; </policy_statement_postfix></policy_statement>
<policy_statement column="2">
<policy_description>Customer intends to Preview the current book</policy_description>
<policy_statement_postfix>&quot;Customer intends to Preview the current book&quot; </policy_statement_postfix></policy_statement>
<policy_statement column="3">
<policy_description>Customer is requestion another page</policy_description>
<policy_statement_postfix>&quot;Customer is requestion another page&quot; </policy_statement_postfix></policy_statement>
<policy_statement column="4">
<policy_description>Handle other Actions</policy_description>
<policy_statement_postfix>&quot;Handle other Actions&quot; </policy_statement_postfix></policy_statement></policy_statements></decision_table>
<decision_table>
<table_name>Purchase_Book</table_name>
<xls_file>BookPreview_dt.xls</xls_file>
<attribute_fields>
<TYPE>FIRST</TYPE>
<COMMENTS>This Rule Set manages the Access to eBooks</COMMENTS></attribute_fields>
<contexts></contexts>
<initial_actions></initial_actions>
<conditions></conditions>
<actions></actions>
<policy_statements></policy_statements></decision_table>
<decision_table>
<table_name>Preview_Book</table_name>
<xls_file>BookPreview_dt.xls</xls_file>
<attribute_fields>
<TYPE>FIRST</TYPE>
<COMMENTS>The goal here is to determine if we should send another page of a book under preview to the customer</COMMENTS></attribute_fields>
<contexts></contexts>
<initial_actions></initial_actions>
<conditions></conditions>
<actions></actions>
<policy_statements></policy_statements></decision_table>
<decision_table>
<table_name>Turn_Page</table_name>
<xls_file>BookPreview_dt.xls</xls_file>
<attribute_fields>
<TYPE>FIRST</TYPE>
<COMMENTS>The goal here is to determine if we should send another page of a book under preview to the customer</COMMENTS></attribute_fields>
<contexts>
<context_details>
<context_number>1</context_number>
<context_comment>Put the book in our context</context_comment>
<context_description>find the book in the open_books then add the open_book to the context of this table</context_description>
<context_postfix>
{ open_book entitypush execute entitypop } { 0 entityfetch $book get book == } open_books forfirst 
</context_postfix></context_details>
<context_details>
<context_number>1</context_number>
<context_comment>Put the book in our context</context_comment>
<context_description>add the book to the context of this table</context_description>
<context_postfix>
book entitypush execute entitypop 
</context_postfix></context_details>
<context_details>
<context_number>2</context_number>
<context_comment>Put the book&apos;s publisher  in the context</context_comment>
<context_description>add the publisher to the context of this table</context_description>
<context_postfix>
publisher entitypush execute entitypop 
</context_postfix></context_details></contexts>
<initial_actions></initial_actions>
<conditions>
<condition_details>
<condition_number>1</condition_number>
<condition_comment>No view_limit means unlimited</condition_comment>
<condition_requirement></condition_requirement>
<condition_description>the page_limit == 0</condition_description>
<condition_postfix>
page_limit 0 == 
</condition_postfix>
<condition_column column_value="N" column_number="1"></condition_column></condition_details>
<condition_details>
<condition_number>2</condition_number>
<condition_comment>Only get to view for view_limit days</condition_comment>
<condition_requirement></condition_requirement>
<condition_description>The days from the start_date to the current_date &gt; the page_limit</condition_description>
<condition_postfix>
start_date current_date daysbetween page_limit &gt; 
</condition_postfix>
<condition_column column_value="Y" column_number="1"></condition_column></condition_details>
<condition_details>
<condition_number>3</condition_number>
<condition_comment>Have they viewed too many pages?</condition_comment>
<condition_requirement></condition_requirement>
<condition_description>the number of pages_viewed + 1  is greater than  the publisher.page_limit</condition_description>
<condition_postfix>
pages_viewed length 1 + publisher.page_limit &gt; 
</condition_postfix>
<condition_column column_value="Y" column_number="2"></condition_column></condition_details>
<condition_details>
<condition_number>4</condition_number>
<condition_comment>Is this page within the viewed chapters</condition_comment>
<condition_requirement></condition_requirement>
<condition_description>the page_number is within the chapters_viewed</condition_description>
<condition_postfix>
 { true } { false } { page_number dup begin_page &gt;= swap end_page &lt;= &amp;&amp; } chapters_viewed forfirstelse 
</condition_postfix>
<condition_column column_value="N" column_number="3"></condition_column>
<condition_column column_value="N" column_number="4"></condition_column></condition_details>
<condition_details>
<condition_number>5</condition_number>
<condition_comment>Check if that chapter is excluded</condition_comment>
<condition_requirement></condition_requirement>
<condition_description>the page_number is within the excluded_chapters</condition_description>
<condition_postfix>
 { true } { false } { page_number dup begin_page &gt;= swap end_page &lt;= &amp;&amp; } excluded_chapters forfirstelse 
</condition_postfix>
<condition_column column_value="Y" column_number="3"></condition_column></condition_details>
<condition_details>
<condition_number>6</condition_number>
<condition_comment>Check chapter limit</condition_comment>
<condition_requirement></condition_requirement>
<condition_description>the number of chapters_viewed +1 is greater than the publisher.chapter_limit</condition_description>
<condition_postfix>
chapters_viewed length 1 + publisher.chapter_limit &gt; 
</condition_postfix>
<condition_column column_value="Y" column_number="4"></condition_column></condition_details>
<condition_details>
<condition_number>7</condition_number>
<condition_comment>None of the exclusion reasons apply?</condition_comment>
<condition_requirement></condition_requirement>
<condition_description>otherwise</condition_description>
<condition_postfix>
otherwise 
</condition_postfix>
<condition_column column_value="*" column_number="5"></condition_column></condition_details></conditions>
<actions>
<action_details>
<action_number>1</action_number>
<action_comment>Do not allow viewing of the next page</action_comment>
<action_requirement></action_requirement>
<action_description>set allow = false</action_description>
<action_postfix>
false cvb /allow xdef  
</action_postfix>
<action_column column_value="X" column_number="1"></action_column>
<action_column column_value="X" column_number="2"></action_column>
<action_column column_value="X" column_number="3"></action_column>
<action_column column_value="X" column_number="4"></action_column></action_details>
<action_details>
<action_number>2</action_number>
<action_comment>Allow viewing of the next page</action_comment>
<action_requirement></action_requirement>
<action_description>set allow = true</action_description>
<action_postfix>
true cvb /allow xdef  
</action_postfix>
<action_column column_value="X" column_number="5"></action_column></action_details></actions>
<policy_statements>
<policy_statement column="1">
<policy_description>The preview period for the book has expired</policy_description>
<policy_statement_postfix>&quot;The preview period for the book has expired&quot; </policy_statement_postfix></policy_statement>
<policy_statement column="2">
<policy_description>The total number of viewable pages has been reached</policy_description>
<policy_statement_postfix>&quot;The total number of viewable pages has been reached&quot; </policy_statement_postfix></policy_statement>
<policy_statement column="3">
<policy_description>The chapter of the next page is excluded from view</policy_description>
<policy_statement_postfix>&quot;The chapter of the next page is excluded from view&quot; </policy_statement_postfix></policy_statement>
<policy_statement column="4">
<policy_description>The total number of viewable chapters has been reached.</policy_description>
<policy_statement_postfix>&quot;The total number of viewable chapters has been reached.&quot; </policy_statement_postfix></policy_statement>
<policy_statement column="5">
<policy_description>Approve the next page</policy_description>
<policy_statement_postfix>&quot;Approve the next page&quot; </policy_statement_postfix></policy_statement></policy_statements></decision_table>
<decision_table>
<table_name>Other_Actions</table_name>
<xls_file>BookPreview_dt.xls</xls_file>
<attribute_fields>
<TYPE>FIRST</TYPE>
<COMMENTS>Handle other requests</COMMENTS></attribute_fields>
<contexts></contexts>
<initial_actions></initial_actions>
<conditions></conditions>
<actions></actions>
<policy_statements></policy_statements></decision_table></decision_tables>